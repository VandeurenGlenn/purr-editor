{"version":3,"file":"backed-node.js","sources":["../src/internals/fire-event.js","../src/internals/to-js-prop.js","../src/internals/load-script.js","../src/internals/pub-sub.js","../src/internals/pub-sub-loader.js","../src/base.js","../src/backed.js"],"sourcesContent":["'use strict';\r\n/**\r\n * @mixin backed\r\n * @param {string} type Name of the event\r\n * @param {HTMLElement} target Name of the event\r\n * @param {string|boolean|number|object|array} detail\r\n */\r\nexport default (type=String, detail=null, target=document) => {\r\n  target.dispatchEvent(new CustomEvent(type, {detail: detail}));\r\n};\r\n","'use strict';\r\n/**\r\n * @mixin Backed\r\n *\r\n * some-prop -> someProp\r\n *\r\n * @arg {string} string The content to convert\r\n * @return {string} string\r\n */\r\nexport default string => {\r\n  let parts = string.split('-');\r\n  if (parts.length > 1) {\r\n    var upper = parts[1].charAt(0).toUpperCase();\r\n    string = parts[0] + upper + parts[1].slice(1).toLowerCase();\r\n  }\r\n  return string;\r\n};\r\n","'use strict';\nconst loadScript = src => {\n  return new Promise((resolve, reject) => {\n    let script = document.createElement('script');\n    script.src = src;\n    script.onload = result => {\n      resolve(result);\n    }\n    script.onerror = error => {\n      reject(error);\n    }\n    document.body.appendChild(script);\n  });\n}\nexport default loadScript;\n","'use strict';\r\nexport default class {\r\n\r\n  /**\r\n   * Creates handlers\r\n   */\r\n  constructor() {\r\n    this.handlers = [];\r\n  }\r\n\r\n  /**\r\n   * @param {String} event\r\n   * @param {Method} handler\r\n   * @param {HTMLElement} context\r\n   */\r\n  subscribe(event, handler, context) {\r\n    if (typeof context === 'undefined') {\r\n      context = handler;\r\n    }\r\n    this.handlers.push({event: event, handler: handler.bind(context)});\r\n  }\r\n\r\n  /**\r\n   * @param {String} event\r\n   * @param {String|Number|Boolean|Object|Array} change\n   */\r\n  publish(event, change) {\n    for (let i = 0; i < this.handlers.length; i++) {\r\n      if (this.handlers[i].event === event) {\n        let oldValue = this.handlers[i].oldValue;\n        // dirty checking value, ensures that we don't create a loop\n        if (oldValue !== change.value) {\n          this.handlers[i].handler(change, this.handlers[i].oldValue);\n          this.handlers[i].oldValue = change.value;\n        }\n      }\r\n    }\r\n  }\r\n}\r\n","'use strict';\r\nimport Pubsub from './pub-sub.js';\nexport default isWindow => {\n  if (isWindow) {\n    window.PubSub = window.PubSub || new Pubsub();\n  } else {\n    global.PubSub = global.PubSub || new Pubsub();\n  }\n}\r\n","'use strict';\r\nimport fireEvent from './internals/fire-event.js';\r\nimport toJsProp from './internals/to-js-prop.js';\r\nimport loadScript from './internals/load-script.js';\r\nimport PubSubLoader from './internals/pub-sub-loader.js';\r\n\r\nconst registeredElements = [];\r\n\r\nconst shouldShim = () => {\r\n  return /Edge/.test(navigator.userAgent) || /Firefox/.test(navigator.userAgent);\r\n}\r\n\r\nconst setupTemplate = ({ name: name, shady: shady }) => {\r\n  try {\r\n    const ownerDocument = document.currentScript.ownerDocument;\r\n    const template = ownerDocument.querySelector(`template[id=\"${name}\"]`);\r\n    if (template) {\r\n      if (shady) {\r\n        ShadyCSS.prepareTemplate(template, name);\r\n      }\r\n      return template;\r\n    }\r\n  } catch (e) {\r\n    return console.warn(e);\r\n  }\r\n}\r\n\r\nconst handleShadowRoot = ({ target: target, template: template }) => {\r\n  if (!target.shadowRoot) {\r\n    target.attachShadow({mode: 'open'});\r\n    if (template) {\r\n      target.shadowRoot.appendChild(\r\n        document.importNode(template.content, true));\r\n\r\n        if (shouldShim()) {\r\n          const styles = target.shadowRoot.querySelectorAll('style');\r\n          let _shimmed;\r\n          if (styles[0]) {\r\n            _shimmed = document.createElement('style');\r\n            target.shadowRoot.insertBefore(_shimmed, target.shadowRoot.firstChild);\r\n          }\r\n          for (let style of styles) {\r\n            _shimmed.innerHTML += style.innerHTML\r\n              .replace(/:host\\b/gm, target.localName)\r\n              .replace(/::content\\b/gm, '');\r\n\r\n            target.shadowRoot.removeChild(style);\r\n          }\r\n        }\r\n    }\r\n  }\r\n}\r\n\r\nconst handleProperties = (target, properties) => {\r\n  if (properties) {\r\n    for (let property of Object.keys(properties)) {\r\n      const observer = properties[property].observer;\r\n      const strict = properties[property].strict;\r\n      const isGlobal = properties[property].global;\r\n      handlePropertyObserver(target, property, observer, {\r\n        strict: strict || false,\r\n        global: isGlobal || false\r\n      });\r\n      target[property] = properties[property].value;\r\n      // Bind(superclass, superclass.properties)\r\n    }\r\n  }\r\n}\r\n\r\nconst handlePropertyObserver = (obj, property, observer, opts={\r\n  strict: false, global:false\r\n}) => {\r\n\r\n  if (observer && _needsObserverSetup(obj, property)) {\r\n    obj.observedProperties.push(property);\r\n\r\n    // subscribe only when a callback is defined, all other global options are still available ...\r\n    if (opts.global && obj[observer]) {\r\n      PubSub.subscribe(`global.${property}`, obj[observer].bind(obj));\r\n    }\r\n    setupObserver(obj, property, observer, opts)\r\n  }\r\n}\r\n\r\nconst _needsObserverSetup = (obj, property) => {\r\n  if (!obj.observedProperties) {\r\n    obj.observedProperties = [];\r\n  }\r\n  if (obj.observedProperties[property]) {\r\n    console.warn(\r\n      'observer::ignoring duplicate property observer ' + property\r\n    );\r\n    return false;\r\n  } else {\r\n    return true;\r\n  }\r\n}\r\n\r\nconst forObservers = (target, observers, isGlobal=false) => {\r\n  for (let observe of observers) {\r\n    let parts = observe.split(/\\(|\\)/g);\r\n    let fn = parts[0];\r\n    parts = parts.slice(1);\r\n    for (let property of parts) {\r\n      if (property.length) {\r\n        handlePropertyObserver(target, property, fn, {\r\n          strict: false,\r\n          global: isGlobal\r\n        });\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Runs a method on target whenever given property changes\r\n *\r\n * example:\r\n * change(change) {\r\n *  change.property // name of the property\r\n *  change.value // value of the property\r\n * }\r\n *\r\n * @arg {object} obj target\r\n * @arg {string} property name\r\n * @arg {boolean} strict\r\n * @arg {method} fn The method to run on change\r\n */\r\nconst setupObserver = (obj, property, fn, opts={\r\n  strict: false, global: false\r\n}) => {\r\n  const isConfigurable = opts.strict ? false : true;\r\n  Object.defineProperty(obj, property, {\r\n    set(value) {\r\n      if (this[`_${property}`] === value) {\r\n        return;\r\n      }\r\n      this[`_${property}`] = value;\r\n      let data = {\r\n        property: property,\r\n        value: value\r\n      };\r\n      if (opts.global) {\r\n        data.instance = this;\r\n        PubSub.publish(`global.${property}`, data);\r\n      } else {\r\n        if (this[fn]) {\r\n          this[fn](data);\r\n        } else {\r\n          console.warn(`observer undefined::${fn} is not a function`);\r\n        }\r\n      }\r\n    },\r\n    get() {\r\n      return this[`_${property}`];\r\n    },\r\n    configurable: isConfigurable\r\n  });\r\n}\r\n\r\n\r\nconst handleObservers = (target, observers=[], globalObservers=[]) => {\r\n  if (!observers && !globalObservers) {\r\n    return;\r\n  }\r\n  forObservers(target, observers);\r\n}\r\n\r\nconst handleListeners = target => {\r\n  const attributes = target.attributes\r\n  for (const attribute of attributes) {\r\n    if (String(attribute.name).includes('on-')) {\r\n      const fn = attribute.value;\r\n      const name = attribute.name.replace('on-', '');\r\n      target.addEventListener(String(name), event => {\r\n        target = event.path[0];\r\n        while (!target.host) {\r\n          target = target.parentNode;\r\n        }\r\n        if (target.host[fn]) {\r\n          target.host[fn]();\r\n        }\r\n      });\r\n    }\r\n  }\r\n}\r\n\r\nconst ready = target => {\r\n  requestAnimationFrame(() => {\r\n    if (target.ready) target.ready();\r\n  });\r\n}\r\n\r\nconst constructorCallback = (target=HTMLElement, hasWindow=false, shady) => {\r\n  PubSubLoader(hasWindow);\r\n\r\n  if (shady) {\r\n    ShadyCSS.styleElement(target)\r\n  }\r\n\r\n  target.fireEvent = target.fireEvent || fireEvent.bind(target);\r\n  target.toJsProp = target.toJsProp || toJsProp.bind(target);\r\n  target.loadScript = target.loadScript || loadScript.bind(target);\r\n\r\n  if (!target.registered && target.created) target.created();\r\n\r\n  // let backed know the element is registered\r\n  target.registered = true;\r\n}\r\n\r\nconst connectedCallback = (target=HTMLElement, klass=Function, template=null) => {\r\n  handleShadowRoot({target: target, template: template});\r\n  if (target.connected) target.connected();\r\n  // setup properties\r\n  handleProperties(target, klass.properties);\r\n  // setup properties\r\n  handleObservers(target, klass.observers, klass.globalObservers);\r\n  // setup listeners\r\n  handleListeners(target)\r\n  // notify everything is ready\r\n  ready(target);\r\n}\r\n\r\nconst shouldRegister = (name, klass) => {\r\n  if (registeredElements.indexOf(name) === -1) {\r\n    registeredElements.push(name);\r\n    return true;\r\n  }\r\n  return false;\r\n}\r\n\r\nexport default {\r\n  setupTemplate: setupTemplate.bind(this),\r\n  handleShadowRoot: handleShadowRoot.bind(this),\r\n  handleProperties: handleProperties.bind(this),\r\n  handlePropertyObserver: handlePropertyObserver.bind(this),\r\n  handleObservers: handleObservers.bind(this),\r\n  setupObserver: setupObserver.bind(this),\r\n  ready: ready.bind(this),\r\n  connectedCallback: connectedCallback.bind(this),\r\n  constructorCallback: constructorCallback.bind(this),\r\n  shouldRegister: shouldRegister.bind(this)\r\n}\r\n","'use strict';\r\nimport base from './base.js';\nconst supportsCustomElementsV1 = 'customElements' in window;\r\nconst supportsCustomElementsV0 = 'registerElement' in document;\nconst supportsShadowDOMV1 = !!HTMLElement.prototype.attachShadow;\n\nconst isWindow = () => {\r\n  try {\r\n    return window;\r\n  } catch(e) {\r\n    return false;\r\n  }\r\n};\r\n\nconst hasWindow = isWindow();\n\n/**\r\n *\r\n * @module backed\r\n * @param {class} _class\r\n */\r\nexport default _class => {\r\n  const upperToHyphen = string => {\r\n    return string.replace(/([A-Z])/g, \"-$1\").toLowerCase().replace('-', '');\r\n  };\r\n\r\n  let klass;\r\n\r\n  // get the tagName or try to make one with class.name\r\n  let name = _class.is || upperToHyphen(_class.name);\r\n\r\n  // Setup properties & observers\r\n  if (hasWindow) {\n    const template = base.setupTemplate({\n      name: name,\n      shady: !supportsShadowDOMV1\n    });\n\n    if (supportsCustomElementsV1) {\n      klass = class extends _class {\r\n        constructor() {\n          super();\n          base.constructorCallback(this, hasWindow, !supportsShadowDOMV1);\n        }\n        connectedCallback() {\n          base.connectedCallback(this, _class, template);\n        }\n        disconnectedCallback() {\n          if (this.disconnected) this.disconnected();\n        }\n      }\n      if (base.shouldRegister(name, klass)) {\n        customElements.define(name, klass);\n      };\n    } else if (supportsCustomElementsV0) {\n      klass = class extends _class {\n        createdCallback() {\n          base.constructorCallback(this, hasWindow, !supportsShadowDOMV1);\n        }\n        attachedCallback() {\n          base.connectedCallback(this, _class, template);\n        }\n        detachedCallback() {\n          if (this.disconnected) this.disconnected();\n        }\n        attachShadow() {\n          // TODO: feature detect shadowDOM for V1\n          return this.createShadowRoot();\n        }\n      }\n      if (base.shouldRegister(name, klass)) {\n        document.registerElement(name, klass)\n      };\n    } else {\r\n      console.warn('classes::unsupported');\r\n    }\r\n  } else {\n    // TODO: handle Commonjs (properties, observers, etc ...)\n    klass = _class;\r\n  }\n  return window[_class.name] = klass;\n};\r\n"],"names":["type","String","detail","target","document","dispatchEvent","CustomEvent","parts","string","split","length","upper","charAt","toUpperCase","slice","toLowerCase","loadScript","Promise","resolve","reject","script","createElement","src","onload","result","onerror","error","body","appendChild","handlers","event","handler","context","push","bind","change","i","oldValue","value","isWindow","PubSub","window","Pubsub","global","registeredElements","shouldShim","test","navigator","userAgent","setupTemplate","name","shady","ownerDocument","currentScript","template","querySelector","prepareTemplate","e","console","warn","handleShadowRoot","shadowRoot","attachShadow","mode","importNode","content","styles","querySelectorAll","_shimmed","insertBefore","firstChild","style","innerHTML","replace","localName","removeChild","handleProperties","properties","Object","keys","property","observer","strict","isGlobal","handlePropertyObserver","obj","opts","_needsObserverSetup","observedProperties","subscribe","forObservers","observers","observe","fn","setupObserver","isConfigurable","defineProperty","data","instance","publish","handleObservers","globalObservers","handleListeners","attributes","attribute","includes","addEventListener","path","host","parentNode","ready","constructorCallback","HTMLElement","hasWindow","styleElement","fireEvent","toJsProp","registered","created","connectedCallback","klass","Function","connected","shouldRegister","indexOf","this","supportsCustomElementsV1","supportsCustomElementsV0","supportsShadowDOMV1","prototype","upperToHyphen","_class","is","base","disconnected","define","createShadowRoot","registerElement"],"mappings":"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"}